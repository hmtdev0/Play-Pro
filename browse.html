<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- font-awesome cdn link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="css/browse.css" />
    <title>Play Pro</title>
</head>

<body class="h-full">
    <div class="p-2 container flex flex-col">
        <div class="tabs" id="tabs"></div>
        <div class="flex md:flex-grow-1 flex-col justify-between items-stretch md:flex-row">
            <div class="sidebar">
                <div class="flex h-full flex-grow-1 flex-col items-center justify-start">
                    <div class="flex items-center w-full">
                        <button type="button" class="bg-transparent p-1 border-none star flex items-center"><i
                                style="font-size: 19px;" class="fa-solid fa-star"></i></button>
                        <div class="search-box" style="flex-grow: 1;">
                            <span class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
                            <input type="text" name="query" id="searchInput" />
                        </div>
                    </div>
                    <div class="w-full flex-grow-1">
                        <div class="p-0 nav-bar-card h-full">
                            <ul id="directory" class="nav-bar">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content h-full flex-grow">
                <div class="web-content flex flex-wrap items-start" id="web-content">
                    <div class="flex md:justify-start flex-wrap flex-col sm:flex-row items-center justify-center"
                        id="main-content">
                    </div>


                </div>
            </div>
        </div>
    </div>


    <script>


        document.addEventListener("DOMContentLoaded", function () {
            let wavesurfer = null;
            let playerTime = document.getElementById('player-time');
            let playControl = document.getElementById('play');
            let replayControl = document.getElementById('replay');
            let volumeControl = document.getElementById('volume');
            let rangeControl = document.getElementById('player-range');


            // Event listener for .voice-card clicks
            document.addEventListener("click", function (event) {
                // Check if the clicked element or its ancestor is a .voice-card
                const voiceCard = event.target.closest(".voice-card");

                if (voiceCard) {
                    // Handle click on .voice-card here
                    const audioFile_play = voiceCard.querySelector(".wave-form").getAttribute("data-audio-file");

                    const form_wave = document.querySelector(".form-wave");
                    console.log(form_wave);

                    if (form_wave) {
                        // Set data-audio-file attribute and clear existing content
                        form_wave.setAttribute("data-audio-file", audioFile_play);
                        form_wave.innerHTML = '';

                        if (wavesurfer) {
                            wavesurfer.destroy(); // Destroy previous wavesurfer instance if exists
                        }

                        // Create new wavesurfer instance
                        wavesurfer = WaveSurfer.create({
                            container: form_wave,
                            waveColor: '#ffffffce',
                            progressColor: '#383351',
                            height: 90,
                            barWidth: 4,
                            responsive: true,
                            barRadius: 4,
                            url: audioFile_play,
                        });

                        // Handle wavesurfer events (ready, audioprocess, seek, finish) here
                        wavesurfer.on('ready', function () {
                            // Get the duration of the audio file
                            let duration = wavesurfer.getDuration();

                            // Format the duration to HH:MM:SS
                            let formattedDuration = new Date(duration * 1000).toISOString().substr(11, 8);

                            // Set the formatted duration to the player-time element
                            playerTime.innerText = formattedDuration;

                            // Reset range control
                            rangeControl.value = 0;
                        });

                        wavesurfer.on('audioprocess', function () {
                            let currentTime = wavesurfer.getCurrentTime();
                            let duration = wavesurfer.getDuration();
                            let remainingTime = duration - currentTime;
                            let formattedTime = new Date(remainingTime * 1000).toISOString().substr(11, 8);
                            playerTime.innerText = formattedTime;

                            // Update range input
                            rangeControl.value = currentTime / duration;
                        });

                        wavesurfer.on('seek', function () {
                            let currentTime = wavesurfer.getCurrentTime();
                            let duration = wavesurfer.getDuration();
                            let remainingTime = duration - currentTime;
                            let formattedTime = new Date(remainingTime * 1000).toISOString().substr(11, 8);
                            playerTime.innerText = formattedTime;
                        });

                        wavesurfer.on('finish', function () {
                            // Reset play button to 'play' icon
                            playControl.querySelector('i').classList.remove('fa-pause');
                            playControl.querySelector('i').classList.add('fa-play');
                        });

                        // Display the player if necessary
                        let player = document.getElementById('player');
                        if (player && player.style.display !== 'block') {
                            player.style.display = 'block';
                        }
                    } else {
                        console.error("Element with class 'form-wave' not found.");
                    }
                }
            });

            // Event listener for playControl
            if (playControl) {
                playControl.addEventListener('click', function () {
                    if (wavesurfer) {
                        wavesurfer.playPause();
                        this.querySelector('i').classList.toggle('fa-play');
                        this.querySelector('i').classList.toggle('fa-pause');
                    }
                });
            }

            // Event listener for replayControl
            if (replayControl) {
                replayControl.addEventListener('click', function () {
                    if (wavesurfer) {
                        wavesurfer.seekTo(0);
                        wavesurfer.play();
                        playControl.querySelector('i').classList.remove('fa-play');
                        playControl.querySelector('i').classList.add('fa-pause');
                    }
                });
            }

            // Event listener for volumeControl
            if (volumeControl) {
                volumeControl.addEventListener('click', function () {
                    if (wavesurfer) {
                        let currentVolume = wavesurfer.getVolume();
                        let newVolume = currentVolume === 0 ? 1 : 0;
                        wavesurfer.setVolume(newVolume);
                        this.querySelector('i').classList.toggle('fa-volume-high');
                        this.querySelector('i').classList.toggle('fa-volume-mute');
                    }
                });
            }

            // Event listener for rangeControl
            if (rangeControl) {
                rangeControl.addEventListener('input', function () {
                    if (wavesurfer) {
                        let seekTo = this.value * wavesurfer.getDuration();
                        wavesurfer.seekTo(seekTo / wavesurfer.getDuration());
                    }
                });
            }
        });

    </script>



    <!-- Use the non-ESM version of WaveSurfer.js -->
    <script src="https://cdn.jsdelivr.net/npm/wavesurfer.js"></script>
    <!-- js script link -->
    <script src="js/browse.js"></script>
</body>

</html>